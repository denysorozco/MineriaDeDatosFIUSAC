# Universidad de San Carlos de Guatemala
# Facultad de Ingeniería
# Escuela de Estudios de Postgrado
# Curso: Mineria de Datos.
# Introducción a la Minería de Datos
# Alumno: Denys Fernando Orozco Escobar
---
title: "Proyecto - Parte 1: Analisis de defunciones y defunciones fetales."
output: html_notebook
---

### Paso 1: Carga de las librerias necesarias para el analisis con el sotfware de RStudio.
```{r}
library(dplyr)
library(arules)
library(ggplot2)
library(fim4r)
library(haven)
library(vctrs)
library(arulesViz)
```

###Paso 2: Cargar archivos a memoria.
### Fuente: https://www.ine.gob.gt/vitales/
```{r}
### Año 01 - 2013
datos_2013_D <- read_sav("_D_2013.sav")
datos_2013_DF <- read_sav("DF_2013.sav")

### Año 02 - 2014
datos_2014_D <- read_sav("_D_2014.sav")
datos_2014_DF <- read_sav("DF_2014.sav")

### Año 03 - 2015
datos_2015_D <- read_sav("_D_2015.sav")
datos_2015_DF <- read_sav("DF_2015.sav")

### Año 04 - 2016
datos_2016_D <- read_sav("_20171204152107_D_2016.sav")
datos_2016_DF <- read_sav("20171204152457_DF_2016.sav")

### Año 05 - 2017
datos_2017_D <- read_sav("_20181226142907_D_2017.sav")
datos_2017_DF <- read_sav("20181226143403_DF_2017.sav")

### Año 06 - 2018
datos_2018_D <-read_sav("_20191129152006_D_2018.sav")
datos_2018_DF <- read_sav("20191129151836_DF_2018.sav")

### Año 07 - 2019 
datos_2019_D <- read_sav("_20201201154851_D_2019.sav")
datos_2019_DF <- read_sav("20201201154808_DF_2019.sav")

### Año 08 - 2020
datos_2020_D <- read_sav("_20210930225530_D_2020.sav")
datos_2020_DF <- read_sav("20210930171901_DF_2020.sav")

### Año 09 - 2021
datos_2021_D <- read_sav("_20220929170549_D_2021.sav")
datos_2021_DF <- read_sav("20220831203224_DF_2021.sav")

### Año 10 - 2022
datos_2022_D <- read_sav("_20230919232405_D_2022.sav")
datos_2022_DF <- read_sav("20230828230013_DF_2022.sav")
```

### Paso 4: Unificar la informacion en memoria en un solo archivo de memoria
```{r}
datos_d <- bind_rows(datos_2013_D,
                     datos_2014_D,
                     datos_2015_D,
                     datos_2016_D,
                     datos_2017_D,
                     datos_2018_D,
                     datos_2019_D,
                     datos_2020_D,
                     datos_2021_D,
                     datos_2022_D)

datos_df <- bind_rows(datos_2013_DF,
                      datos_2014_DF,
                      datos_2015_DF,
                      datos_2016_DF,
                      datos_2017_DF,
                      datos_2018_DF,
                      datos_2019_DF,
                      datos_2020_DF,
                      datos_2021_DF,
                      datos_2022_DF)

datos_2013_DF <- datos_2013_DF[-23]
datos_2014_DF <- datos_2014_DF[-23]
datos_2015_DF <- datos_2015_DF[-24]
datos_2016_DF <- datos_2016_DF[-24]
datos_2017_DF <- datos_2017_DF[-24]
datos_2018_DF <- datos_2018_DF[-23]
datos_2019_DF <- datos_2019_DF[-23]
datos_2020_DF <- datos_2020_DF[-23]
datos_2021_DF <- datos_2021_DF[-23]
datos_2022_DF <- datos_2022_DF[-23]

datos_df <- bind_rows(datos_2013_DF,
                      datos_2014_DF,
                      datos_2015_DF,
                      datos_2016_DF,
                      datos_2017_DF,
                      datos_2018_DF,
                      datos_2019_DF,
                      datos_2020_DF,
                      datos_2021_DF,
                      datos_2022_DF)
```

### Uso del algoritmo APRIORI para buscar reglas de asociacion
```{r}
reglas_apriori_d <- apriori(datos_d, parameter = list(support = 0.3, confidence = 0.5))
reglas_apriori_df <- apriori(datos_df, parameter = list(support = 0.3, confidence = 0.5))

inspect(reglas_apriori_d[0:100])
inspect(reglas_apriori_df[0:100])

reglas_apriori_d_interesantes <- head(sort(reglas_apriori_d, by = "lift"), 10)
plot(reglas_apriori_d_interesantes, method = "graph")

reglas_apriori_df_interesantes <- head(sort(reglas_apriori_df, by = "lift"), 10)
plot(reglas_apriori_df_interesantes, method = "graph")
```

### Uso del algoritmo FPGrowth
```{r}
datos_d$Depreg <- as_factor(datos_d$Depreg)
reglas_fpgrowth_d <- fim4r(datos_d, method = "fpgrowth", target="rules", supp = .2, conf = .5)
```

